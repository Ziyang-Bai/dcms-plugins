<?include_once '../sys/inc/start.php';include_once '../sys/inc/compress.php';include_once '../sys/inc/sess.php';include_once '../sys/inc/home.php';include_once '../sys/inc/settings.php';include_once '../sys/inc/db_connect.php';include_once '../sys/inc/ipua.php';include_once '../sys/inc/fnc.php';include_once '../sys/inc/user.php';$set['title']='Поиск'; // заголовок страницыinclude_once '../sys/inc/thead.php';title();aut();//////////////////////////////function words($search, $text){    $search = str_replace('*', '', $search);    return mb_strlen($search) < 3 ? $text : preg_replace('|(' . preg_quote($search, '/') . ')|siu', '<span style="background-color: #FFFF33">$1</span>', $text);}///////////////////////////////////////function mb_ucfirst($str) {    $str = mb_strtoupper(mb_substr($str, 0, 1, 'UTF-8'), 'UTF-8') .            mb_strtolower(mb_substr($str, 1, mb_strlen($str), 'UTF-8'), 'UTF-8');    return $str;  }$search_p = isset($_POST['search']) ? trim($_POST['search']) : false;$search_g = isset($_GET['search']) ? rawurldecode(trim($_GET['search'])) : false;$searchs = $search_p ? $search_p :$search_g;$search = str_replace(" ","|",mb_ucfirst($searchs));$search=mb_ucfirst($search);echo "<div class='mess'> Введите город,район или страну <br><form method=\"post\" action=\"\"> <input type=\"text\" name=\"search\" maxlength=\"30\" value=\"" . ($search ? stripcslashes(htmlspecialchars($searchs )): '') . "\" /><br />\n";echo "<input type=\"submit\" value=\"Поиск\" />";echo "</form></div>\n";////////////////// $error = $search && mb_strlen($search) < 4 || mb_strlen($search) > 30 ? true : false; if ($search && !$error) {$k_post=mysql_result(mysql_query("SELECT COUNT(id) FROM `user` WHERE `city` rlike '".mysql_real_escape_string($search)."' OR `country` rlike '".mysql_real_escape_string($search)."' OR `region` rlike '".mysql_real_escape_string($search)."' "),0);if($k_post=='0'){echo '<div class="mess">Нет результатов!</div>';}else{echo '<div class="nav1">Найдено совпадений <b>'.$k_post.'</b></div>';$k_page=k_page($k_post,$set['p_str']);$page=page($k_page);$start=$set['p_str']*$page-$set['p_str'];$q=mysql_query("SELECT id FROM `user` WHERE `city` rlike '".mysql_real_escape_string($search)."' OR `country` rlike '".mysql_real_escape_string($search)."' OR `region` rlike '".mysql_real_escape_string($search)."' LIMIT $start, $set[p_str] ");while ($ank = mysql_fetch_assoc($q)){$ank=get_user($ank['id']);echo '<table class="post"><div class="' . ($num % 2 ? "nav1" : "nav2") . '">'; echo status($ank['id']).group($ank['id']).'<a href="/info.php?id='.$ank['id'].'">'.$ank['nick'].'</a>'.online($ank['id']).'';echo words($search,city($ank['id']));echo '</div></table>';$num++;}if ($k_page>1)str("?search=".stripcslashes(htmlspecialchars(urlencode($searchs)))."&amp;",$k_page,$page); // Вывод страниц}}echo "<div class='nav2'><img src='/style/icons/str2.gif' alt='*'> <a href='users.php'>Пользователи</a></div>";/////////////////////include_once '../sys/inc/tfoot.php';?>